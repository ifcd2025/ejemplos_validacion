<!DOCTYPE html>
<html lang="es">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title></title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
   <!-- Esto no se pide en el examen -->
    <style>
        :user-invalid {
            background-color: rgb(236, 193, 193);
        }
    </style>
</head>
<body>
    <h1>Validación con JavaScript puro </h1>
    <p>Debemos poner el atributo novalidate en el formulario o no poner 
        required, min, dejar todos tipo text,....<br>
        Podemos poner el atributo novalidate en el formulario para que
        ni siquera valide si un type email es email,...
    </p>
    <form action="" class="w-25 bg-secondary m-3 p-2" novalidate>
        <label for="titular">Titular</label>
        <input type="text" id="titular" name="titular" 
        class="form-control mb-2" required minlength="5">
        <label for="telefono">Teléfono</label>
        <input type="tel" id="telefono" name="telefono"
         class="form-control mb-2" required pattern="\d{3}-\d{3}-\d{3}" placeholder="999-999-999">
        <label for="fechaAlta">Fecha alta</label>
        <input type="date" id="fechaAlta" name="fechaAlta" class="form-control mb-2" required>
        <label for="saldoInicial">Saldo inicial</label>
        <input type="number" id="saldoInicial" 
            name="saldoInicial" class="form-control mb-2" required min="100">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" class="form-control mb-2" required>
        <input type="submit" value="dar de alta" class="btn btn-primary">

        <div>Todos los datos son obligatorios, el titular que tenga al menos 5 caracteres,
            el saldo inicial al menos de 100 euros, el teléfono de la forma 999-999-999
        </div>
    </form>
    <script>
        document.querySelector("form").addEventListener("submit", comprobar);

        function comprobar(evt) {
            const errores = [];
            const titular = document.getElementById("titular");
            // No olvidarse hacer el trim para quitar posibles espacios a los lados
            // En los repaso1.htm y repaso2.htm no daría error poner solo espacios
            if(/^.{5,}$/.test(titular.value.trim()) == false) {
                errores.push("Falta el titular o no tiene 5 caracteres mínimo");
            }
            const telefono = document.getElementById("telefono");
            if(/^\d{3}-\d{3}-\d{3}$/.test(telefono.value) == false) {
                errores.push("Falta el teléfono o no es correcto");
            }
            const fechaAlta = document.getElementById("fechaAlta");
            if(fechaAlta.valueAsDate == null) {
                errores.push("Elige la fecha");
            }       
            const saldoInicial = document.getElementById("saldoInicial");
            if(/[1-9]\d{2,}/.test(saldoInicial.value)) {
                errores.push("falta el saldo o es menor que 100");
            }     
            const email = document.getElementById("email");
            // Una validación demasiado simple que no admite muchos emails válidos
            if(/^[a-z]+@[a-z]+(\.[a-z]+)?$/.test(email.value) == false) {
                errores.push("Falta el email o es incorrecto");
            }        
            if(errores != []) {
                evt.preventDefault(); // cancelamos el envío
                // Para que no se vayan acumulando uls, vemos si existe:
                let ul = document.querySelector("ul");
                if(ul == null) {
                    ul = document.createElement("ul");
                } else {
                    ul.textContent = "";
                }
                // Sería más fácil tener el ul creado en el HTML, cogerlo
                // y borrar su contenido
                document.body.appendChild(ul);
                for(const error of errores) {
                    const li = document.createElement("li");
                    ul.appendChild(li);
                    li.textContent = error;
                }
            }
        }
    </script>
</body>
</html>